import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go

# 데이터 불러오기
data = 'C:\Users\2-09\Desktop\WOORI_FISA_05_DATA_Practice\data\Disability_Assistance.csv'
# 데이터 불러오기
'''data = """
년도,시도,기초생활수급자 수급자-일반,기초생활수급자 수급자-중증,차상위계층 수급자-일반, 차상위초과
2018,서울특별시,22206,2528,5034,22917
2018,부산광역시,11964,1365,2210,10807
2018,대구광역시,7871,1531,1587,6821
2018,인천광역시,7729,1079,1579,8143
2018,광주광역시,4810,1050,1041,3778
2018,대전광역시,4298,909,910,4434
2018,울산광역시,1996,378,728,3076
2018,세종특별자치시,376,253,120,659
2018,경기도,24088,4849,7038,34437
2018,강원도,5877,1389,1467,5742
2018,충청북도,5523,2006,1234,5776
2018,충청남도,6829,2042,1549,8774
2018,전라북도,9463,1867,1947,7167
2018,전라남도,9848,1586,2267,8435
2018,경상북도,10908,2494,2624,10894
2018,경상남도,11039,1943,2669,11531
2018,제주특별자치도,1781,486,535,2421
2019,서울특별시,23751,2421,4123,23099
2019,부산광역시,12537,1305,1839,10831
2019,대구광역시,8355,1489,1309,6925
2019,인천광역시,8184,1055,1323,8291
2019,광주광역시,5025,1035,869,3963
2019,대전광역시,4520,905,775,4481
2019,울산광역시,2140,398,672,3148
2019,세종특별자치시,406,254,110,723
2019,경기도,25926,4840,6068,34826
2019,강원도,6125,1391,1285,5759
2019,충청북도,5766,2016,1129,5860
2019,충청남도,7026,2048,1385,8758
2019,전라북도,9737,1847,1711,7153
2019,전라남도,10056,1568,1963,8493
2019,경상북도,11198,2569,2341,11029
2019,경상남도,11418,1935,2412,11624
2019,제주특별자치도,1859,486,466,2382
2020,서울특별시,25255,2299,3516,23197
2020,부산광역시,13206,1273,1595,10987
2020,대구광역시,8725,1491,1180,7156
2020,인천광역시,8734,1076,1196,8409
2020,광주광역시,5323,1021,741,4010
2020,대전광역시,4803,940,720,4620
2020,울산광역시,2375,440,609,3176
2020,세종특별자치시,450,254,91,740
2020,경기도,27579,5050,5487,35692
2020,강원도,6357,1454,1103,5779
2020,충청북도,5981,2064,1019,5989
2020,충청남도,7343,2057,1208,8788
2020,전라북도,10071,1873,1488,7153
2020,전라남도,10302,1582,1745,8459
2020,경상북도,11450,2666,2128,11070
2020,경상남도,11973,1940,2201,11773
2020,제주특별자치도,1950,500,398,2479
2021,서울특별시,26198,2239,2798,21997
2021,부산광역시,13674,1227,1303,10498
2021,대구광역시,9055,1462,915,6989
2021,인천광역시,9063,1098,969,8100
2021,광주광역시,5536,1000,593,3934
2021,대전광역시,4996,972,593,4412
2021,울산광역시,2534,480,473,3095
2021,세종특별자치시,475,241,80,725
2021,경기도,28898,5128,4610,34820
2021,강원도,6475,1425,866,5592
2021,충청북도,6182,2130,829,5757
2021,충청남도,7669,2057,1000,8523
2021,전라북도,10278,1912,1157,6944
2021,전라남도,10480,1578,1378,8292
2021,경상북도,11785,2731,1725,10672
2021,경상남도,12388,1940,1801,11419
2021,제주특별자치도,2022,519,303,2404
2022,서울특별시,26372,2138,2376,20775
2022,부산광역시,13809,1191,1077,10012
2022,대구광역시,9085,1406,749,6667
2022,인천광역시,9162,1091,856,7861
2022,광주광역시,5619,964,504,3763
2022,대전광역시,5061,977,511,4191
2022,울산광역시,2631,486,380,2893
2022,세종특별자치시,506,233,79,680
2022,경기도,29621,5104,3875,33183
2022,강원도,6461,1419,715,5365
2022,충청북도,6245,2046,693,5479
2022,충청남도,7751,2031,858,8109
2022,전라북도,10312,1874,984,6533
2022,전라남도,10454,1527,1229,7906
2022,경상북도,11871,2719,1433,10128
2022,경상남도,12682,1887,1528,10872
2022,제주특별자치도,2063,515,252,2298
""" '''

# CSV 데이터 DataFrame으로 변환
from io import StringIO
csv_data = StringIO(data)
df = pd.read_csv(csv_data)

# 전국 데이터 집계
df_national = df.groupby('년도')[['기초생활수급자 수급자-일반', '기초생활수급자 수급자-중증', '차상위계층 수급자-일반', ' 차상위초과']].sum().reset_index()
df_national['시도'] = '전국'

# 시도 선택을 위한 selectbox
available_cities = df['시도'].unique()
selected_city = st.selectbox('시도를 선택하세요:', ['전국'] + list(available_cities))

# 선택된 시도에 따라 DataFrame 필터링
if selected_city == '전국':
    df_selected = df_national
else:
    df_selected = df[df['시도'] == selected_city]

# Streamlit 제목
st.title(f'{selected_city} 기초생활수급자 및 차상위계층 현황')

# y축 범위 조정 함수
def create_line_chart(df, y_column, title, y_label):
    fig = go.Figure()
    fig.add_trace(go.Scatter(x=df['년도'], y=df[y_column], mode='lines', name=y_column))

    # y축 범위 자동 조정
    min_val = df[y_column].min()
    max_val = df[y_column].max()
    range_extension = (max_val - min_val) * 0.1  # 10% 여유
    fig.update_layout(
        title=title,
        xaxis_title='년도',
        yaxis_title=y_label,
        yaxis=dict(range=[min_val - range_extension, max_val + range_extension]),
        xaxis = dict(
            tickmode = 'linear',
            tick0 = df['년도'].min(),
            dtick = 1  # 1년 단위로 눈금 표시
        )
    )
    st.plotly_chart(fig)

# 기초생활수급자 변화 추이
st.header("기초생활수급자 변화 추이")

st.subheader("기초생활수급자 수급자-일반 변화 추이")
create_line_chart(df_selected, '기초생활수급자 수급자-일반', f'{selected_city} 기초생활수급자 수급자-일반 변화 추이', '수급자 수')

st.subheader("기초생활수급자 수급자-중증 변화 추이")
create_line_chart(df_selected, '기초생활수급자 수급자-중증', f'{selected_city} 기초생활수급자 수급자-중증 변화 추이', '수급자 수')

# 차상위계층 변화 추이
st.header("차상위계층 변화 추이")

st.subheader("차상위계층 수급자-일반 변화 추이")
create_line_chart(df_selected, '차상위계층 수급자-일반', f'{selected_city} 차상위계층 수급자-일반 변화 추이', '수급자 수')

st.subheader("차상위초과 변화 추이")
create_line_chart(df_selected, ' 차상위초과', f'{selected_city} 차상위초과 변화 추이', '수급자 수')
